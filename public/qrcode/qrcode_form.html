<html>

<head>
    <link rel="stylesheet" type="text/css" href="//jutb.oss-cn-hangzhou.aliyuncs.com/web/themes/px/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="//jutb.oss-cn-hangzhou.aliyuncs.com/web/themes/px/static/css/common.css">
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script type="text/javascript">
        if (navigator.appName == 'Microsoft Internet Explorer') {
            if (navigator.userAgent.indexOf("MSIE 5.0") > 0 || navigator.userAgent.indexOf("MSIE 6.0") > 0 || navigator.userAgent.indexOf("MSIE 7.0") > 0) {
                alert('您使用的 IE 浏览器版本过低, 推荐使用 Chrome 浏览器或 IE8 及以上版本浏览器.');
            }
        }
        window.sysinfo = {
            'uniacid': '97', 'acid': '97', 'uid': '124', 'siteroot': '//qn.jutaobao.cc/',
            'siteurl': '//qn.jutaobao.cc/web/index.php?c=site&a=entry&do=import&m=yunbei_mic&from=yunbei_mic',
            'attachurl': '//orxy33ots.bkt.clouddn.com/',
            'attachurl_local': '//qn.jutaobao.cc/attachment/',
            'attachurl_remote': '//orxy33ots.bkt.clouddn.com/',
            'MODULE_URL': '//qn.jutaobao.cc/addons/yunbei_mic/', 'cookie': { 'pre': '57da_' },
            'account': {
                "acid": "97", "uniacid": "97", "token": "neujlx2350l5x20sgdfrs5hnmi2kof1i", "encodingaeskey": "Dvl2wLQ3GvNgzGtqFbFs9z2kI45ckCPnEFyIcYGF8Ay", "access_token": "", "level": "4", "name": "\u597d\u8bc4\u795e\u5668", "account": "haopingshenqi", "original": "gh_02dc42ab5454", "signature": "", "country": "", "province": "", "city": "", "username": "", "password": "", "lastupdate": "0", "key": "wx8f8eba9ba0137d2b", "secret": "bf4acc86a24a6e57f6d67a072f228584", "styleid": "1", "jsapi_ticket": "", "subscribeurl": "", "topad": "", "footad": "", "auth_refresh_token": "refreshtoken@@@7wQUvEa9rWZ3kSbb2TkUaflu4RxXOvfLNOjN_AyjT8g", "default_acid": "97", "type": "3", "uid": "124", "starttime": "1487839503", "endtime": "1527091200", "groups": { "97": { "groupid": "97", "uniacid": "97", "title": "\u9ed8\u8ba4\u4f1a\u5458\u7ec4", "orderlist": "0", "isdefault": "1", "credit": "0" } }, "grouplevel": "0"
            }
        }; 
    </script>
    <script>var require = { urlArgs: 'v=2018052315' };</script>

    <script type="text/javascript" src="//jutb.oss-cn-hangzhou.aliyuncs.com/web/resource/js/app/util.js"></script>
    <script type="text/javascript" src="//jutb.oss-cn-hangzhou.aliyuncs.com/web/resource/js/require.js"></script>
    <script type="text/javascript" src="//jutb.oss-cn-hangzhou.aliyuncs.com/web/resource/js/app/config.js"></script>


    <script type="text/javascript" src="//jutb.oss-cn-hangzhou.aliyuncs.com/web/resource/js/lib/jquery-1.11.1.min.js"></script>

    <script type="text/javascript" src="//cdn.staticfile.org/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
    <div class="form-horizontal form" id="form1">
        <div class="menuTitle">
            <h3>二维码数据操作</h3>
        </div>
        <div class="panel-body">

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">
                    <span class="text-danger">*</span> 二维码名称</label>
                <div class="col-sm-3 col-xs-3">
                    <input type="text" name="qrcode_name" id="qrcode_name" class="form-control" value="" />
                    <span class="help-block"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">
                    <span class="text-danger">*</span> 总数</label>
                <div class="col-sm-3 col-xs-3">
                    <input type="text" name="tatol" id="total" class="form-control" value="" />
                    <span class="help-block"></span>
                </div>
            </div>


            <form action="" id="form" enctype="multipart/form-data" method="POST">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">
                        <span class="text-danger">*</span> 文件名：</label>
                    <div class="col-sm-3 col-xs-3">
                        <input type="hidden" name="type" value="image">
                        <input type="file" id="file" name="photo">
                        <a id="img_submit" onclick="sub()" class='btn-sm'>提交</a>
                        <!-- <button id="img_submit" >提交</button> -->
                        <span class="help-block"></span>
                    </div>
                </div>
            </form>





            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                <div class="col-sm-4 col-xs-4">
                    <div class="input-group ">
                        <input type="hidden" name="qr_url" id="qr_url" value="">
                        <a id="submit" type="submit" class="btn btn-primary ">提交</a>

                    </div>
                </div>
            </div>






        </div>
    </div>
    </div>

</body>
<script>
    $(function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
        var aid = 97;
        var operating = $.getUrlParam('operating');
        var gid = $.getUrlParam('gid');
        var id = $.getUrlParam('id');

        $.ajax({
            url: "//wechat.yunbeisoft.com/index_test.php/home/qrcode/liove_qrcode_" + operating,
            type: "POST",
            dataType: "json",
            data: JSON.stringify({ 'id': id, 'aid': aid }),
            success: function (xhr) {
                //this 默认为调用本次AJAX请求时传递的options参数
                //alert(xhr);
                $('#qrcode_name').val(xhr['data']['qrcode_name']);
                $('#qr_url').val(xhr['data']['qr_url']);
                $('#total').val(xhr['data']['total']);


            }

        }),

            $('#submit').click(function () {
                var qrcode_name = $('#qrcode_name').val();
                var qr_url = $('#qr_url').val();
                var total = $('#total').val();
                var use_num = $('#use_num').val();
                $.ajax({
                    url: "//wechat.yunbeisoft.com/index_test.php/home/qrcode/liove_qrcode_" + operating,
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify({
                        'id': id,
                        'aid': aid,
                        "post": 1,
                        "qrcode_name": qrcode_name,
                        "qr_url": qr_url,
                        "total": total,

                        "group_id": gid

                    }),
                    success: function (xhr) {
                        if (xhr['error'] == true) {
                            alert(xhr['error']['msg']);
                        } else {
                            alert("数据操作成功");
                            window.location.replace("qrcodeing.html?gid=" + gid);
                        }
                    }
                })
            })



    })


    function sub() {
        // var form = new FormData(document.getElementById("form"));
        // var data = $('#form').serialize();
        var formdata = new FormData();
        // 上传到服务器的字段名称
        // type 
        // photo 
        formdata.append("photo", $('#file')[0].files[0]);
        formdata.append("type", "image");
        $.ajax({
            url: "//wechat.yunbeisoft.com/index_test.php/home/fileupload/upload",
            type: "POST",
            cache: false,
            data: formdata,
            timeout: 5000,
            //必须false才会避开jQuery对 formdata 的默认处理 
            // XMLHttpRequest会对 formdata 进行正确的处理
            processData: false,
            //必须false才会自动加上正确的Content-Type 
            contentType: false,
            success: function (xhr) {
                xhr = JSON.parse(xhr);
                if (xhr['error'] == true) {
                    alert(xhr['msg']);
                } else {
                    //alert(data['msg']);
                    alert("上传成功");
                    $('#qr_url').val(xhr['data'][0]['url']);

                }
            }
        })
    }
</script>

</html>